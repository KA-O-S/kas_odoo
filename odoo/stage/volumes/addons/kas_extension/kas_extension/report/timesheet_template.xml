<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_timesheet_account_move_kas_ex" >
        <t t-set="show_project" t-value="true"/>
        <t t-set="show_task" t-value="true"/>
        <t t-call="web.html_container">

            <div t-attf-class="header" >
                <div class="row">
                      <t t-if="not o" t-set="o" t-value="doc"/>

                        <t t-if="not company">
                            <!-- Multicompany -->
                            <t t-if="company_id">
                                <t t-set="company" t-value="company_id"/>
                            </t>
                            <t t-elif="o and 'company_id' in o and o.company_id.sudo()">
                                <t t-set="company" t-value="o.company_id.sudo()"/>
                            </t>
                            <t t-else="else">
                                <t t-set="company" t-value="res_company"/>
                            </t>
                        </t>
                    <div class="col-12" style="text-align: center;">
                        <img t-if="company.timesheet_logo" t-att-src="image_data_uri(company.timesheet_logo)" style="max-height: 100px; width: 100%; object-fit: contain;" alt="Logo"/>
                    </div>
                </div>
            </div>
                <div t-attf-class="article o_report_layout_standard">
                <div class="page">
                    <t t-foreach="docs" t-as="doc">
                        <t t-set="doc_name" t-value="doc.name"/>
                        <t t-if="with_order_id" t-set="doc_name" t-value="str(doc.order_id.name) +' - '+ str(doc_name)"/>
                        <t t-elif="doc_name == '/'" t-set="doc_name" t-value="'Draft'"/>
                        <div class="oe_structure"/>
                        <div class="row mt8">
                            <div class="col-12">
                                <t t-if="doc.timesheet_ids">
                                    <h5 style="color: #00578e;">Zeitnachweis: Einzelaufstellung
                                    <t t-if="from_project"> - gesamte Projektzeit</t>
                                    </h5>
                                    <br></br>
                                    <h5 style="color: #00578e; font-weight: bold;">
                                        <span>Mandant:
                                             <t t-if="'partner_id' in docs">
                                                <t t-out="doc.partner_id.name"/>
                                            </t>
                                            <t t-elif="'order_id' in docs and 'partner_id' in doc.order_id">
                                                <t t-out="doc.order_id.partner_id.name"/>
                                            </t>
                                            <t t-else="">
                                                <span>Partner information not available</span>
                                            </t>
                                        </span>
                                    </h5>
                                    <h5 style="color: #00578e; font-weight: bold; ">
                                        <t t-if="'origin_contract' in docs">
                                            <span style="margin-right: 20px;">Vertrag vom:
                                            <t t-esc="doc.origin_contract.date_order.strftime('%d.%m.%Y')"/>
                                            </span>
                                        </t>
                                        <t t-if="'period_performance' in docs">
                                            <span>Abrechnungszeitraum:
                                            <t t-out="doc.period_performance"/>
                                            </span>
                                        </t>
                                    </h5>

                                    <t t-set='lines' t-value='doc.timesheet_ids'/>
                                    <t t-call="kas_extension.kas_timesheet_table"/>
                                </t>
                            </div>
                        </div>
                    </t>
                </div>
                </div>
            <!--</t>-->
            <div t-attf-class="footer o_standard_footer">
                <div t-if="report_type == 'pdf'" class="text-muted" style="text-align: left;">
                        Seite: <span class="page"/> / <span class="topage"/>
                </div>
            </div>
        </t>

    </template>
    <template id="kas_extension.kas_timesheet_table">

        <t t-set='is_uom_day' t-value='lines._is_timesheet_encode_uom_day()'/>

        <div class="row mt8">
            <div class="col-12">
                <style>
                    .table td, .table th {
                        vertical-align: top !important;
                    }
                </style>

                <table class="table table-sm o_main_table table-borderless mt-4">
                    <thead>
                        <tr style="border-top: 2px solid #d3d3d3; border-bottom: 2px solid #d3d3d3;">
                            <t t-set="timesheet_record_label" t-value="False"/>
                            <t t-if="show_task">
                                <t t-set="timesheet_record_label">Task</t>
                            </t>
                            <t t-elif="show_project">
                                <t t-set="timesheet_record_label">Project</t>
                            </t>
                            <th class="text-start align-middle" style="color: #d3d3d3; padding: 0 10px;"><span>Datum</span></th>
                            <th class="text-start align-middle" style="color: #d3d3d3; padding: 0 10px;"><span>Bearbeiter</span></th>
                            <th class="text-start align-middle" style="color: #d3d3d3; padding: 0 10px;"><span>Projekt</span></th>
                            <th class="text-start align-middle" style="color: #d3d3d3; padding: 0 10px;"><span>TÃ¤tigkeits- <br></br>kategorie</span></th>
                            <th class="text-start align-middle" style="color: #d3d3d3; padding: 0 10px;"><span>Beschreibung</span></th>
                            <th class="align-middle" style="color: #d3d3d3; text-align: center; padding: 0 10px;">
                                <span t-if="not is_uom_day">Zeitaufwand<br></br>(15-Min-T)<br></br>hh:mm</span>
                                <span t-else="">Tage</span>
                            </th>
                            <th class="align-middle" style="color: #d3d3d3;">Teilnehmer</th>
                        </tr>
                   </thead>
                   <tbody>
                        <tr t-foreach="lines" t-as="line" >
                            <td class="align-middle" style="font-size: 80%; padding: 0.2% 0;">
                               <span t-field="line.date">2021-09-01</span>
                            </td>
                            <td class="align-middle" style="font-size: 80%; padding: 0.2% 0;">
                               <span t-if="line.user_id.partner_id.name" t-field="line.user_id.partner_id.name">Audrey Peterson</span>
                               <span t-else="" t-field="line.employee_id">Audrey Peterson</span>
                            </td>
                            <td class="align-middle" style="font-size: 80%; padding: 0.2% 0;">
                                <span t-out="line.project_id.sudo().name">Research and Development/New Portal System</span>
                            </td>
                            <td class="align-middle" style="font-size: 80%; padding: 0.2% 0;"><span t-out="line.task_id.sudo().name"></span></td>
                            <td class="align-middle" style="font-size: 80%; padding: 0.2% 0;">
                                <span t-field="line.name" t-options="{'widget': 'text'}">Call client and discuss project</span>
                            </td>
                            <td class="align-middle" style="text-align: center; font-size: 80%; padding: 0.2% 0;">
                                <span t-if="not is_uom_day" t-field="line.unit_amount" t-options="{'widget': 'duration', 'digital': True, 'unit': 'hour', 'round': 'minute'}">2 hours</span>
                                <span t-else="" t-esc="line._get_timesheet_time_day()" t-options="{'widget': 'timesheet_uom'}">1 day</span>
                            </td>
                            <td class="align-middle" style="font-size: 80%; padding: 0.2% 0;">

                                <span t-esc="line.contact_person_names"/>

                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </template>

    <template id="timesheet_report_sale_order_kas">
        <t t-set="record_name">Sales Order Item</t>
        <t t-set="with_order_id" t-value="true"/>
        <t t-set="docs" t-value="docs.order_line"/>
        <t t-call="kas_extension.report_timesheet_account_move_kas_ex"/>
    </template>

    <template id="timesheet_report_project_kas">
        <t t-set="record_name">Project Item</t>
        <t t-set="from_project" t-value="True"/>
        <t t-call="kas_extension.report_timesheet_account_move_kas_ex"/>
    </template>
</odoo>